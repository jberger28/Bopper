pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
-- bopper
-- by jared berger

-- globals
clown = {}
balloons = {}
hiscore = 0
mode = 0
-->8
-- init functions
function _init()
	score = 0
	clown.x = 10
	clown.y = 10
	num_balloons = 1
	updated = time()
	initBalloon()
	backround()
	print("press x to start", 32, 80)
end

-- create a new balloon
function initBalloon()
	bal = {}
	bal.x = flr(rnd(110)) + 8
	bal.y = 120
	bal.dx = 1
	bal.dy = 1
	num = flr(rnd(3))
	if num == 0 then
		bal.color = "yellow"
	elseif num == 1 then
		bal.color = "orange"
	else bal.color = "pink"
	end
	balloons[num_balloons] = bal
end
-->8
-- update functions

function _update()
	if mode == 1 then
		if num_balloons < 4 then
			step = 20
		elseif num_balloons < 7 then
			step = 35
		else step = 45
		end
		thetime = time()
		if thetime - updated > step then
			num_balloons += 1
			initBalloon()
			updated = thetime
		end
		escape()
		moveClown()
		wallCollision()
		bopped()
		moveBal()
	else
		if btn(5) then
			mode = 1
			updated = time()
		end
	end
end

-- check if balloon has floated away
function escape()
	for i = 1, num_balloons do
		if balloons[i].y <= -16 then
			sfx(1)
			mode = 0
			if score > hiscore then
				hiscore = score
			end
			_init()
		end
	end
end

-- check user input to move clown
function moveClown()
	if btn(0) then
		if clown.x > -3 then
			clown.x = clown.x - 2
		end
	end
	if btn(1) then
		if clown.x < 123 then
			clown.x = clown.x + 2
		end
	end
end

-- check if balloon hit wall or ground
function wallCollision()
	for i = 1, num_balloons do
		if balloons[i].x <= 0 or balloons[i].x >= 123
		then balloons[i].dx = -1 * balloons[i].dx
			sfx(4)
		end
		if balloons[i].y >= 123
		then balloons[i].dy = -1* balloons[i].dy
			sfx(4)
		end
	end
end

-- check if balloon was bopped by our clown
function bopped()
	for i = 1, num_balloons do
		bal = balloons[i]
		xdir = xhit(bal)
		ydir = yhit(bal)
		if xdir~= nil and ydir~=nil then
			sfx(2)
			score += 1

			if bal.dx < 0 then
				if xdir <= clown.x + 2 then
					bal.dx = -1 * bal.dx
				end

			elseif bal.dx >= 0 then
				if xdir >= clown.x + 4 then
					bal.dx = -1 * bal.dx
				end
			end
			bal.dy = -1 * bal.dy
		end
	end
end

-- check if balloon hit clown in x direction
function xhit(bal)
	if bal.x + 1 >= clown.x - 8 and bal.x + 1 <= clown.x + 13 then
		return bal.x + 4
	end
	return nil
end

-- check if balloon hit clown in y direction
function yhit(bal)
	if bal.y + 1 == clown.y + 7 then
		return true
	end
	return nil
end

-- move balloons every frame
function moveBal()
	for i = 1, num_balloons do
		balloons[i].x -= balloons[i].dx
		balloons[i].y -= balloons[i].dy
	end
end

-->8
-- draw functions


function _draw()
	if mode == 0 then
		spr(64, 40, 40, 6, 1)
		spr(0, 55, 56)
		draw_bunch(55 + 7, 56-7)
	elseif mode == 1 then
		backround()
		spr(0, clown.x, clown.y)
		draw_bunch(clown.x + 7, clown.y -7)
		for i = 1, num_balloons do
			draw_bal(balloons[i])
		end

		print("score", 1, 1)
		print(score, 25, 1)
		print("high score", 71, 1)
		print(hiscore, 115, 1)
	end
end

-- draw a single balloon
function draw_bal (bal)
	x = bal.x
	y = bal.y
	if bal.color == "pink" then
		spr(1, x, y)
	elseif bal.color == "orange" then
		spr(4, x, y)
	elseif bal.color == "yellow" then
		spr(3, x, y)
	end
	spr(2, x-1 ,y+5)
end

-- draw background
function backround()
	cls(12)
	rectfill(0,100,128, 128, 3)
end

-- draw bunch of balloons
function draw_bunch(x,y)
	spr(1, x, y)
	spr(2, x-1 ,y+5)
	spr(3, x, y + 4)
	spr(4, x + 4, y + 2)
end
__gfx__
88888880000000000000000000000000000000008888888000000000000000000000000000000000000000000000000000000000000000000000000000000000
8777778000eeee000000000000aaaa00009999008777778000eee000000000000000000000000000000000000000000000000000000000000000000000000000
870707800eeeeee0000005000aaaaaa009999990877777800eeeee00000000000000000000000000000000000000000000000000000000000000000000000000
877877800eeeeee0000005000aaaaaa009999990877877800eeeee00000000000000000000000000000000000000000000000000000000000000000000000000
887778800eeeeee0000005000aaaaaa009999990887778800eeeee00000000000000000000000000000000000000000000000000000000000000000000000000
d3d7d3d00eeeeee0000550000aaaaaa009999990d3d7d3d000eee000000000000000000000000000000000000000000000000000000000000000000000000000
0a393a0000eeee000050000000aaaa00009999000a393a0000000000000000000000000000000000000000000000000000000000000000000000000000000000
09aaa9000000000000000000000000000000000009aaa90000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88888000888888808888888088888880888888808888888088888888000000000000000000000000000000000000000000000000000000000000000000000000
80008800800000808000008080000080800000008000008088888888000000000000000000000000000000000000000000000000000000000000000000000000
80000800800000808000008080000080800000008000008088888888000000000000000000000000000000000000000000000000000000000000000000000000
80008800800000808000008080000080800000008000008088888888000000000000000000000000000000000000000000000000000000000000000000000000
88888800800000808888888088888880888888808888888088888888000000000000000000000000000000000000000000000000000000000000000000000000
80000800800000808000000080000000800000008080000088888888000000000000000000000000000000000000000000000000000000000000000000000000
80000800800000808000000080000000800000008008000088888888000000000000000000000000000000000000000000000000000000000000000000000000
88888000888888808000000080000000888888808000800088888888000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0001000000000000000d05000000140501b05024050230500d0500d0500d0500d050130500d050000000d0500d050000000000000000000000000000000000000000000000000000000000000000000000000000
001000001d0501d00012000160001c0001d0001f0001d0000f0000f0000d0001200023000140001800000000150001c0000d00014000140000f00012000230001d000100000d0001a0000d000000000000000000
011000001c050140001c0001b0002a100008001c0000aa001b0001700023000160001a0001400023000140001800000000150001c0000d000160001c0000f00017000230001d000190000d0001a0000d00000000
001000011d0501d000140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000001705023000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
00 02424344
01 01424344
